MGCM (Magicami) Skill Data
==========================

這個 Repo 記錄 MGCM 各服裝攻擊技能的倍率。歡迎開 PR/Issue 補充。

傷害公式
--------

```
傷害 = 攻擊力
  * (1 + 攻擊力buff + 特殊加攻)
  * 技能倍率
  * 升技Bonus
  * 被動技能倍率
  * 是否暴擊 (1.5)
  * 是否強打 (1.3)
  * 是否失誤 (0.7)
  * 750 / (防禦力 + 750)
  * 傷害浮動
```

* 攻擊力buff - buff時為 0.5，debuff為 -0.5，兩者皆有時為 0。
* 特殊加攻 - 有些技能會根據HP/防禦增加攻擊力，例︰2019莉莉的2技、ISHTAR伊麗莎的1,3技。
* 技能倍率 - 見此 repo 中的其它檔案。
* 升技Bonus - 有些技能升級後會增加傷害，10% 就 x1.1，10% + 5% 就 x1.15。
* 被動技能 - 有些被動技能會增加傷害，例︰惡魔彩花爆擊時傷害 1.5 倍。
<! -- * 暴擊/強打/失誤 - 暴擊不會和強打同時發生，但暴擊會和失誤同時發生？-->
* 傷害浮動 - 隨機乘上 0.985, 0.995, 1.005, 1.015 其中一個值。

> **Note:** 特殊加攻的部份還未驗證完畢，可以確定的是它會稀釋攻擊buff/debuff的效果。

傷害浮動
--------

由於最終傷害並不是單一數值，測試時需要測出四種傷害再找出中間值，或是測出最低和最高的傷害再取平均。

> **Note:** 避免以失誤/降攻狀態時的傷害去推算原始傷害，以免小數誤差被放大

測出敵人防禦力
--------------

利用降防或無視防禦的技能，可以得出敵人的防禦力。公式為

```
-750 * (降防前傷害 - 降防後傷害) / (降防前傷害 - K * 降防後傷害)
```

降防的情況下 K 為 0.3，無視防禦的情況下 K 為 0。

以下為說明︰設攻擊為 A，防禦為 B，降防後的防禦為 K*B，降防前的傷害為 D1，降防後的傷害為 D2，則

```
D1 = A * 750 / (B + 750)
D2 = A * 750 / (K*B + 750)

=> D1 / D2 = (K*B + 750) / (B + 750)

=> B = -750 (D1 - D2) / (D1 - D2 * K)
```

測出技能倍率
------------

知道敵人的防禦後就能很容易的用攻擊力算出技能倍率︰

```
技能倍率 = 傷害 / (750 / (防禦力 + 750)) / 攻擊力
```

或是用其它技能的傷害比率來算︰

```
B技能倍率 = A技能倍率 * B技能傷害 / A技能傷害
```

和 [ヒムラン](https://twitter.com/Br51XxvpgRwyDjk) 之間的差異
-------------------------------------------------------------

* 所乘上的常數不同。ヒムラン的技能威力 * 1.75 / 750 = 這裡的技能倍率。
* ヒムラン使用浮動傷害中的最低傷害來計算技能威力，所以ヒムラン的技能倍率 / 0.985 = 這裡的技能倍率。

Todos
-----

* 有些資料小數點精度太低，需要重測。
* 特殊加攻 - 有些技能會根據HP/防禦增加攻擊力（例︰2019莉莉的2技），測出倍率的公式。不同技能有共用同一個公式嗎？同衣服上的技能有共用同一個公式嗎？
* 測試時常常有些微妙的誤差。例如︰原本傷害1613，失誤時變1130。顯示的數字是無條件進位的嗎？
* 傷害計算機。由技能倍率乘上各服裝於各LV的攻擊力來算出該技能的傷害。
* 傷害Ranking？加上CD來算出服裝每回合能造成的傷害。分單體/多體？

Reference
----------

* [ヒムラン](https://twitter.com/Br51XxvpgRwyDjk)

  - 傷害公式: https://twitter.com/Br51XxvpgRwyDjk/status/1183932508922171393
  - 技能Bonus: https://twitter.com/Br51XxvpgRwyDjk/status/1185455902377181184
